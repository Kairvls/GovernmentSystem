{% extends 'index.html' %}

{% block title %}Event schedule list{% endblock %}

{% block content %}

<section class="home">
    <p>Events</p>
    

    <div class='add-emp'

    style="
        
        display: flex; 
        align-items: center; 
        justify-content: start; 
        margin-left: 70px;
        margin-top: 40px;
        ">
    <button title="Add new employee" type="button" 
    class="btn btn-primary"
    data-bs-toggle="modal" 
    data-bs-target="#addCustomModal"
    >Add event
        
    
    </button>
    </div>



<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Date</th>
                <th scope="col">Event Name</th>
                <th scope="col">Time-in</th>
                <th scope="col">Time-out</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        
        <tbody>
            {% for schedule in schedules %}
            <tr>
                <td>{{ schedule.date }}</td>
                <td>{{ schedule.reason|default:"N/A" }}</td> <!-- Default to "N/A" if reason is blank -->
                <td>{{ schedule.time_in }}</td>
                <td>{{ schedule.time_out }}</td>
                 <td>
                   
                        
                
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editModal-{{ schedule.id }}">
                            Edit 
                        </button>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal-{{ schedule.id }}">
                            Delete
                        </button>

                     
                        {% for schedule in schedules %}
                        <div class="modal fade" id="deleteModal-{{ schedule.id }}" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true" data-bs-backdrop="false">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete this schedule?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <form action="{% url 'delete_sched' schedule.id %}" method="POST">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}


{% if messages %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {% for message in messages %}
                Swal.fire({
                    icon: 'success',
                    title: 'Deleted Successfully',
                    text: '{{ message|escapejs }}',
                    showCloseButton: true,
                    confirmButtonText: 'OK'
                });
            {% endfor %}
        });
    </script>
{% endif %}
                    </div>
                </td>
                
                
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No schedules available.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>



<!-- Modal -->
<div class="modal fade" id="addCustomModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true" data-bs-backdrop="false">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="signupModalLabel">Add Custom attendance</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST">
                    {% csrf_token %}
                    <label for="selected_date">Select Date:</label>
                    <input type="date" name="selected_date" id="selected_date" required>
        
                    <label for="custom_timein">Custom time-in (HH:MM):</label>
                    <input type="time" name="custom_timein" required>
                    
                    <label for="custom_timeout">Custom Timeout (HH:MM):</label>
                    <input type="time" name="custom_timeout" required>
                            
                    <label for="reason">Event name:</label>
                    <input name="reason" placeholder="Enter event for custom attendance"></input>
                    
                   
                    <div class="modal-footer">
                        <button type="submit">Set event</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



{% if alert_message and alert_icon %}
<script>
    Swal.fire({
        title: '{{ alert_icon|capfirst }}',
        text: '{{ alert_message }}',
        icon: '{{ alert_icon }}', // 'success', 'error', 'warning', etc.
        confirmButtonText: 'OK'
    });
</script>
{% endif %}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get today's date in the format YYYY-MM-DD
            const today = new Date().toISOString().split("T")[0];
            const dateInput = document.getElementById("selected_date");
        
            // Set the 'min' attribute to today's date to disable past dates
            dateInput.setAttribute("min", today);
        
            // Optionally, set today's date as the default value if no other date is selected
            if (!dateInput.value) {
                dateInput.value = today;
            }
        });
    </script>
    





    {% for schedule in schedules %}

 <!-- Edit Modal -->
 <div class="modal fade" id="editModal-{{ schedule.id }}" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true" data-bs-backdrop="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'edit_sched' schedule.id %}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="selected_date-{{ schedule.id }}" class="form-label">Select Date:</label>
                        <input type="date" name="selected_date" id="selected_date-{{ schedule.id }}" class="form-control" value="{{ schedule.date|date:'Y-m-d' }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="custom_timein-{{ schedule.id }}" class="form-label">Custom Time-in (HH:MM):</label>
                        <input type="time" name="custom_timein" id="custom_timein-{{ schedule.id }}" class="form-control" value="{{ schedule.time_in|time:'H:i' }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="custom_timeout-{{ schedule.id }}" class="form-label">Custom Time-out (HH:MM):</label>
                        <input type="time" name="custom_timeout" id="custom_timeout-{{ schedule.id }}" class="form-control" value="{{ schedule.time_out|time:'H:i' }}" required>
                    </div>

                    <div class="mb-3">
                        <label for="reason-{{ schedule.id }}" class="form-label">Reason for Change:</label>
                        <input type="text" name="reason" id="reason-{{ schedule.id }}" class="form-control" value="{{ schedule.reason }}" required>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}
</section>

{% endblock %}